h<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minhas Passagens ¬∑ CGH ‚Üî CWB</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#06090f; --surface:#0e1520; --surface2:#161f2e; --surface3:#1c2a3e;
      --border:#1e2d42; --border2:#263650;h
      --accent:#3b82f6; --accent-glow:rgba(59,130,246,0.15);
      --green:#10b981; --orange:#f59e0b; --red:#ef4444; --purple:#8b5cf6;
      --gol:#f07720; --latam:#e8223f; --azul:#1e40af;
      --text:#e2e8f0; --muted:#4a6080; --muted2:#6b82a0;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'DM Mono',monospace;background:var(--bg);color:var(--text);min-height:100vh;}
    body::before{content:'';position:fixed;inset:0;
      background-image:linear-gradient(rgba(59,130,246,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,0.04) 1px,transparent 1px);
      background-size:48px 48px;pointer-events:none;z-index:0;}
    .wrap{max-width:920px;margin:0 auto;padding:36px 20px;position:relative;z-index:1;}
    .logo-tag{font-size:10px;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px;}
    .logo-tag::before{content:'';display:block;width:20px;height:1px;background:var(--accent);}
    h1{font-family:'Syne',sans-serif;font-size:clamp(26px,5vw,46px);font-weight:800;line-height:1.05;letter-spacing:-1px;margin-bottom:6px;}
    h1 em{font-style:normal;color:var(--gol);}
    .header-sub{color:var(--muted2);font-size:11px;margin-bottom:32px;}
    .stats-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px;}
    @media(max-width:600px){.stats-bar{grid-template-columns:repeat(2,1fr);}}
    .stat{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:16px;position:relative;overflow:hidden;}
    .stat::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;}
    .stat.blue::after{background:var(--accent);}
    .stat.green::after{background:var(--green);}
    .stat.orange::after{background:var(--orange);}
    .stat.gol::after{background:var(--gol);}
    .stat-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;line-height:1;margin-bottom:6px;}
    .stat.blue .stat-val{color:var(--accent);}
    .stat.green .stat-val{color:var(--green);}
    .stat.orange .stat-val{color:var(--orange);}
    .stat.gol .stat-val{color:var(--gol);}
    .stat-label{font-size:10px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;}
    .tabs{display:flex;gap:4px;border-bottom:1px solid var(--border);margin-bottom:28px;}
    .tab{padding:10px 18px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:.5px;cursor:pointer;border:none;background:none;color:var(--muted2);border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .2s;}
    .tab.active{color:var(--accent);border-bottom-color:var(--accent);}
    .tab:hover:not(.active){color:var(--text);}
    .panel{display:none;}
    .panel.active{display:block;}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px;margin-bottom:20px;}
    .card-title{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:3px;color:var(--muted2);text-transform:uppercase;margin-bottom:20px;display:flex;align-items:center;gap:10px;}
    .card-title::after{content:'';flex:1;height:1px;background:var(--border);}
    .tpl-box{background:var(--surface2);border:1px solid var(--border2);border-radius:6px;padding:18px;margin-bottom:20px;}
    .tpl-row{display:flex;align-items:center;gap:12px;margin-bottom:10px;flex-wrap:wrap;}
    .tpl-row:last-child{margin-bottom:0;}
    .tpl-label{font-size:10px;color:var(--muted2);letter-spacing:1px;text-transform:uppercase;width:80px;flex-shrink:0;}
    .tpl-val{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;}
    .gol-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(240,119,32,.12);border:1px solid rgba(240,119,32,.4);color:var(--gol);border-radius:3px;padding:3px 10px;font-size:12px;font-family:'Syne',sans-serif;font-weight:700;}
    .weeks-nav{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
    .week-btn{background:var(--surface2);border:1px solid var(--border);color:var(--muted2);border-radius:4px;padding:7px 14px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;cursor:pointer;transition:all .2s;}
    .week-btn:hover{border-color:var(--accent);color:var(--accent);}
    .week-label{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;flex:1;text-align:center;}
    .dates-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
    @media(max-width:480px){.dates-grid{grid-template-columns:1fr;}}
    .date-block{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:16px;}
    .date-dir{font-size:10px;letter-spacing:2px;color:var(--muted2);text-transform:uppercase;margin-bottom:6px;}
    .date-val{font-family:'Syne',sans-serif;font-weight:800;font-size:17px;margin-bottom:3px;}
    .date-info{font-size:11px;color:var(--muted2);}
    .limit-bar{display:flex;align-items:center;gap:12px;background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.25);border-radius:4px;padding:12px 16px;margin-bottom:16px;font-size:12px;}
    .limit-bar strong{color:var(--green);}
    .search-links{display:flex;flex-direction:column;gap:10px;}
    .sl-card{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:16px 18px;display:flex;align-items:center;gap:14px;flex-wrap:wrap;transition:border-color .2s;}
    .sl-card:hover{border-color:var(--border2);}
    .sl-card.priority{border-color:rgba(240,119,32,.4);background:rgba(240,119,32,.04);}
    .sl-airline{font-family:'Syne',sans-serif;font-weight:800;font-size:13px;width:55px;flex-shrink:0;}
    .sl-info{flex:1;min-width:140px;}
    .sl-route{font-size:12px;font-weight:500;margin-bottom:3px;}
    .sl-detail{font-size:11px;color:var(--muted2);}
    .sl-actions{display:flex;gap:8px;align-items:center;flex-shrink:0;flex-wrap:wrap;}
    .tag-pref{font-size:10px;letter-spacing:1px;padding:2px 8px;border-radius:2px;font-family:'Syne',sans-serif;font-weight:700;background:rgba(240,119,32,.15);color:var(--gol);border:1px solid rgba(240,119,32,.3);}
    .tag-alt{font-size:10px;padding:2px 8px;border-radius:2px;font-family:'Syne',sans-serif;font-weight:700;background:rgba(107,130,160,.1);color:var(--muted2);border:1px solid var(--border);}
    a.btn-search{display:inline-flex;align-items:center;gap:5px;background:var(--accent);color:#fff;border:none;border-radius:4px;padding:8px 14px;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;cursor:pointer;text-decoration:none;transition:opacity .2s;white-space:nowrap;}
    a.btn-search:hover{opacity:.85;}
    a.btn-search.gol-btn{background:var(--gol);}
    button.btn-reg{background:var(--green);color:#000;border:none;border-radius:4px;padding:8px 14px;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;cursor:pointer;white-space:nowrap;transition:opacity .2s;}
    button.btn-reg:hover{opacity:.85;}
    .sep{text-align:center;color:var(--muted);font-size:11px;margin:6px 0;letter-spacing:2px;}
    .table-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden;}
    .table-header{padding:16px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;}
    .table-title{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:3px;color:var(--muted2);text-transform:uppercase;}
    .filter-row{display:flex;gap:8px;}
    .filter-btn{background:var(--surface2);border:1px solid var(--border);border-radius:3px;padding:5px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2);cursor:pointer;transition:all .2s;}
    .filter-btn.active{background:var(--accent-glow);border-color:var(--accent);color:var(--accent);}
    table{width:100%;border-collapse:collapse;}
    thead th{text-align:left;padding:11px 18px;font-size:10px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;border-bottom:1px solid var(--border);background:var(--surface2);font-weight:400;}
    tbody tr{border-bottom:1px solid var(--border);transition:background .15s;}
    tbody tr:last-child{border-bottom:none;}
    tbody tr:hover{background:var(--surface2);}
    td{padding:12px 18px;font-size:13px;vertical-align:middle;}
    .route-cell{font-family:'Syne',sans-serif;font-weight:700;}
    .arrow{color:var(--muted);margin:0 4px;}
    .cia-badge{display:inline-flex;align-items:center;gap:5px;background:var(--surface3);border:1px solid var(--border2);border-radius:3px;padding:3px 10px;font-size:11px;}
    .cia-dot{width:6px;height:6px;border-radius:50%;}
    .price-cell{font-family:'Syne',sans-serif;font-weight:700;color:var(--green);}
    .date-cell{color:var(--muted2);font-size:12px;}
    .time-cell{color:var(--accent);font-size:12px;font-style:italic;}
    .del-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:15px;padding:4px 8px;border-radius:3px;transition:all .2s;}
    .del-btn:hover{color:var(--red);background:rgba(239,68,68,.1);}
    .empty-state{text-align:center;padding:50px 20px;color:var(--muted);}
    .empty-state .icon{font-size:36px;margin-bottom:10px;}
    .form-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}
    @media(max-width:560px){.form-grid{grid-template-columns:1fr 1fr;}}
    .edt-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:15px;padding:4px 8px;border-radius:3px;transition:all .2s;} .edt-btn:hover{color:var(--accent);background:rgba(59,130,246,.1);}
    .field{display:flex;flex-direction:column;gap:6px;}
    .field label{font-size:10px;color:var(--muted2);letter-spacing:1px;text-transform:uppercase;}
    .inp{background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:10px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;outline:none;transition:border-color .2s;width:100%;}
    .inp:focus{border-color:var(--accent);}
    .btn-add{background:var(--accent);color:#fff;border:none;border-radius:4px;padding:11px 24px;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;cursor:pointer;transition:opacity .2s;margin-top:14px;}
    .btn-add:hover{opacity:.85;}
    .bars{display:flex;align-items:flex-end;gap:8px;height:90px;}
    .bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:5px;}
    .bar-col{width:100%;background:var(--accent);border-radius:3px 3px 0 0;min-height:3px;transition:height .4s;}
    .bar-label{font-size:9px;color:var(--muted2);text-align:center;}
    .bar-val{font-size:10px;color:var(--accent);font-family:'Syne',sans-serif;font-weight:700;}
    .cia-split{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;}
    .cia-item{background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:10px 16px;flex:1;min-width:100px;}
    .cia-name{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;}
    .cia-sub{font-size:11px;color:var(--muted2);}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:100;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;}
    .overlay.open{opacity:1;pointer-events:all;}
    .modal{background:var(--surface);border:1px solid var(--border2);border-radius:8px;padding:28px;width:90%;max-width:440px;transform:translateY(16px);transition:transform .2s;}
    .overlay.open .modal{transform:translateY(0);}
    .modal-title{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;margin-bottom:6px;}
    .modal-sub{font-size:11px;color:var(--muted2);margin-bottom:20px;}
    .mrow{display:flex;gap:10px;margin-bottom:12px;}
    .mfield{flex:1;display:flex;flex-direction:column;gap:6px;}
    .mfield label{font-size:10px;color:var(--muted2);letter-spacing:1px;text-transform:uppercase;}
    .mfooter{display:flex;gap:10px;margin-top:20px;justify-content:flex-end;}
    .btn-cancel{background:var(--surface2);border:1px solid var(--border);color:var(--muted2);border-radius:4px;padding:10px 18px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;cursor:pointer;}
    .btn-confirm{background:var(--green);color:#000;border:none;border-radius:4px;padding:10px 20px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;cursor:pointer;}
    .toast{position:fixed;bottom:28px;right:28px;background:var(--green);color:#000;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;padding:12px 22px;border-radius:4px;z-index:999;opacity:0;transform:translateY(10px);transition:all .3s;pointer-events:none;}
    .toast.show{opacity:1;transform:translateY(0);}
    .buy-signal{position:fixed;top:18px;right:18px;z-index:200;border-radius:8px;padding:10px 16px;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;line-height:1.45;max-width:220px;box-shadow:0 4px 24px rgba(0,0,0,.4);cursor:default;transition:all .3s;}
    .buy-signal .bs-icon{font-size:18px;margin-bottom:4px;display:block;}
    .buy-signal .bs-title{font-size:13px;font-weight:800;display:block;margin-bottom:2px;}
    .buy-signal .bs-sub{font-size:10px;font-weight:400;opacity:.85;display:block;}
    .buy-signal.good{background:linear-gradient(135deg,#065f46,#10b981);border:1px solid rgba(16,185,129,.5);color:#fff;}
    .buy-signal.wait{background:linear-gradient(135deg,#78350f,#f59e0b);border:1px solid rgba(245,158,11,.5);color:#fff;}
    .buy-signal.bad{background:linear-gradient(135deg,#7f1d1d,#ef4444);border:1px solid rgba(239,68,68,.4);color:#fff;}
    .buy-signal .bs-tooltip{display:none;position:absolute;top:calc(100% + 8px);right:0;background:var(--surface);border:1px solid var(--border2);border-radius:6px;padding:12px 14px;font-size:10px;font-weight:400;color:var(--muted2);line-height:1.7;width:240px;box-shadow:0 4px 20px rgba(0,0,0,.4);}
    .buy-signal:hover .bs-tooltip{display:block;}
    .sl-card.best-pick{border-color:var(--green);background:rgba(16,185,129,.06);box-shadow:0 0 0 1px rgba(16,185,129,.3);}
    .sl-card.best-pick:hover{border-color:var(--green);}
    .best-pick-banner{display:flex;align-items:center;gap:6px;background:var(--green);color:#000;font-family:'Syne',sans-serif;font-weight:800;font-size:10px;letter-spacing:1.5px;padding:4px 10px;border-radius:3px;white-space:nowrap;}
    .criteria-score{font-size:10px;color:var(--muted2);margin-top:4px;}
    .criteria-score span{color:var(--green);}
    .best-pick-cta{background:var(--green);color:#000;border:none;border-radius:4px;padding:9px 16px;font-family:'Syne',sans-serif;font-weight:800;font-size:12px;cursor:pointer;white-space:nowrap;transition:opacity .2s;display:flex;align-items:center;gap:5px;}
    .best-pick-cta:hover{opacity:.85;}
    /* ‚îÄ‚îÄ Price ranking styles ‚îÄ‚îÄ */
    .freshness-bar{display:flex;align-items:center;gap:8px;margin-bottom:14px;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;font-size:11px;color:var(--muted2);}
    .freshness-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
    .price-tag{font-family:'Syne',sans-serif;font-weight:800;font-size:15px;margin-top:4px;}
    .price-tag.real{color:var(--green);}
    .price-tag.estimated{color:var(--muted2);font-style:italic;}
    .price-breakdown{font-size:10px;color:var(--muted2);margin-top:2px;}
    .price-breakdown span{color:var(--accent);}
    .rank-badge{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;font-family:'Syne',sans-serif;font-weight:800;font-size:11px;flex-shrink:0;}
    .rank-badge.r1{background:var(--green);color:#000;}
    .rank-badge.r2{background:var(--surface3);color:var(--muted2);border:1px solid var(--border2);}
    .rank-badge.r3{background:var(--surface3);color:var(--muted);border:1px solid var(--border);}
    .budget-tag{font-size:9px;letter-spacing:1px;padding:2px 8px;border-radius:2px;font-family:'Syne',sans-serif;font-weight:700;white-space:nowrap;}
    .budget-tag.under{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.3);}
    .budget-tag.over{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.3);}
    .sl-card.mixed{border-color:var(--purple);border-style:dashed;}
    .mix-tag{font-size:9px;letter-spacing:1px;padding:2px 8px;border-radius:2px;font-family:'Syne',sans-serif;font-weight:700;background:rgba(139,92,246,.12);color:var(--purple);border:1px solid rgba(139,92,246,.3);}
    .source-tag{font-size:9px;padding:1px 6px;border-radius:2px;font-family:'DM Mono',monospace;margin-left:6px;}
    .source-tag.live{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.2);}
    .source-tag.hist{background:rgba(107,130,160,.1);color:var(--muted2);border:1px solid var(--border);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo-tag">TRACKER PESSOAL ¬∑ GOL SMILES</div>
    <h1>CGH ‚Üî CWB<br><em>Toda Quinta</em></h1>
    <div class="header-sub">Congonhas (SP) ‚Üí Curitiba ¬∑ Lazer pessoal ¬∑ Limite R$ 500 ida+volta c/ taxas</div>

    <div class="stats-bar">
      <div class="stat blue"><div class="stat-val" id="s-total">R$ 0</div><div class="stat-label">Total Gasto</div></div>
      <div class="stat green"><div class="stat-val" id="s-count">0</div><div class="stat-label">Passagens</div></div>
      <div class="stat orange"><div class="stat-val" id="s-media">R$ 0</div><div class="stat-label">M√©dia / voo</div></div>
      <div class="stat gol"><div class="stat-val" id="s-gol">0</div><div class="stat-label">Voos GOL</div></div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('buscar')">üîç Buscar Voo</button>
      <button class="tab" onclick="showTab('historico')">üìã Hist√≥rico</button>
      <button class="tab" onclick="showTab('manual')">‚úèÔ∏è Registrar</button>
      <button class="tab" onclick="showTab('analytics')">üìä Analytics</button>
    </div>

    <!-- BUSCAR -->
    <div id="tab-buscar" class="panel active">
      <div class="card">
        <div class="card-title">Seu Template de Rota</div>
        <div class="tpl-box">
          <div class="tpl-row"><div class="tpl-label">Rota</div><div class="tpl-val">CGH ‚Üí CWB (ida) &nbsp;¬∑&nbsp; CWB ‚Üí CGH (volta)</div></div>
          <div class="tpl-row"><div class="tpl-label">Ida</div><div class="tpl-val">Quintas-feiras ¬∑ ap√≥s 19h00</div></div>
          <div class="tpl-row"><div class="tpl-label">Volta</div><div class="tpl-val">Domingos ¬∑ ap√≥s 18h00</div></div>
          <div class="tpl-row"><div class="tpl-label">Limite</div><div class="tpl-val" style="color:var(--green)">R$ 500 total com taxas</div></div>
          <div class="tpl-row"><div class="tpl-label">Prefer√™ncia</div><div class="gol-badge">‚úà GOL ¬∑ Smiles</div></div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Pr√≥ximas Semanas</div>
        <div class="weeks-nav">
          <button class="week-btn" onclick="prevWeek()">‚Üê Anterior</button>
          <div class="week-label" id="week-label">‚Äî</div>
          <button class="week-btn" onclick="nextWeek()">Pr√≥xima ‚Üí</button>
        </div>
        <div class="dates-grid">
          <div class="date-block">
            <div class="date-dir">‚úà IDA</div>
            <div class="date-val" id="d-quinta">‚Äî</div>
            <div class="date-info">Quinta-feira ¬∑ ap√≥s 19h00</div>
          </div>
          <div class="date-block">
            <div class="date-dir">‚Ü© VOLTA</div>
            <div class="date-val" id="d-domingo">‚Äî</div>
            <div class="date-info">Domingo ¬∑ ap√≥s 18h00</div>
          </div>
        </div>
        <div class="limit-bar">
          üéØ Limite: <strong>&nbsp;R$ 500&nbsp;</strong> ida+volta com taxas. GOL preferencial para ac√∫mulo Smiles. Ap√≥s conferir o pre√ßo no site, clique em <strong>&nbsp;Registrar no Tracker</strong>.
        </div>
        <div id="freshness-bar" class="freshness-bar" style="display:none;">
          <span class="freshness-dot" id="freshness-dot"></span>
          <span id="freshness-text">Carregando pre√ßos...</span>
        </div>
        <div class="search-links" id="links-container"><!-- JS --></div>
      </div>
    </div>

    <!-- HIST√ìRICO -->
    <div id="tab-historico" class="panel">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">Hist√≥rico de Voos</div>
          <div class="filter-row">
            <button class="filter-btn active" onclick="filterBy('all',this)">Todos</button>
            <button class="filter-btn" onclick="filterBy('GOL',this)">GOL</button>
            <button class="filter-btn" onclick="filterBy('LATAM',this)">LATAM</button>
            <button class="filter-btn" onclick="filterBy('Azul',this)">Azul</button>
          </div>
        </div>
        <div id="table-wrap"></div>
      </div>
    </div>

    <!-- REGISTRAR MANUAL -->
    <div id="tab-manual" class="panel">
      <div class="card">
        <div class="card-title">Registrar Passagem Manualmente</div>
        <div class="form-grid">
          <div class="field"><label>Origem</label><input class="inp" id="f-origem" value="CGH" maxlength="3" style="text-transform:uppercase"/></div>
          <div class="field"><label>Destino</label><input class="inp" id="f-destino" value="CWB" maxlength="3" style="text-transform:uppercase"/></div>
          <div class="field"><label>Companhia</label>
            <select class="inp" id="f-cia"><option value="GOL">GOL</option><option>LATAM</option><option>Azul</option><option>Outra</option></select>
          </div>
          <div class="field"><label>Data do Voo</label><input class="inp" id="f-data" type="date"/></div>
          <div class="field"><label>Hor√°rio</label><input class="inp" id="f-hora" type="time"/></div>
          <div class="field"><label>Pre√ßo Total (R$)</label><input class="inp" id="f-preco" type="number" placeholder="0,00" step="0.01" min="0"/></div>
        </div>
        <button class="btn-add" onclick="addManual()">‚úà Registrar Passagem</button>
      </div>
    </div>

    <!-- ANALYTICS -->
    <div id="tab-analytics" class="panel">
      <div class="card">
        <div class="card-title">Gastos por M√™s</div>
        <div class="bars" id="bars-container"><span style="color:var(--muted);font-size:12px;margin:auto">Nenhum dado ainda.</span></div>
      </div>
      <div class="card">
        <div class="card-title">Por Companhia</div>
        <div class="cia-split" id="cia-split"><span style="color:var(--muted);font-size:12px">Sem registros.</span></div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modal-title">‚úÖ Registrar Passagem</div>
      <div class="modal-sub" id="m-context">Preencha os dados ap√≥s confirmar o pre√ßo no site.</div>
      <div class="mrow">
        <div class="mfield"><label>Origem</label><input class="inp" id="m-origem" maxlength="3" style="text-transform:uppercase"/></div>
        <div class="mfield"><label>Destino</label><input class="inp" id="m-destino" maxlength="3" style="text-transform:uppercase"/></div>
      </div>
      <div class="mrow">
        <div class="mfield"><label>Companhia</label>
          <select class="inp" id="m-cia"><option value="GOL">GOL</option><option>LATAM</option><option>Azul</option><option>Outra</option></select>
        </div>
        <div class="mfield"><label>Hor√°rio partida</label><input class="inp" id="m-hora" type="time"/></div>
      </div>
      <div class="mrow">
        <div class="mfield"><label>Data do Voo</label><input class="inp" id="m-data" type="date"/></div>
        <div class="mfield"><label>Pre√ßo Pago (R$)</label><input class="inp" id="m-preco" type="number" step="0.01" placeholder="0,00"/></div>
      </div>
      <div class="mfooter">
        <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
        <button class="btn-confirm" onclick="confirmRegister()">‚úì Confirmar Registro</button>
      </div>
    </div>
  </div>

  <div class="buy-signal" id="buy-signal">
    <span class="bs-icon" id="bs-icon"></span>
    <span class="bs-title" id="bs-title"></span>
    <span class="bs-sub" id="bs-sub"></span>
    <div class="bs-tooltip" id="bs-tooltip"></div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const COR = {GOL:'#f07720',LATAM:'#e8223f',Azul:'#1e40af',Outra:'#8b5cf6'};

    const _defaultFlights = [
      {id:1001, orig:'CWB', dest:'CGH', cia:'GOL', data:'2026-03-06', hora:'18:05', preco:274.22},
      {id:1002, orig:'CGH', dest:'CWB', cia:'GOL', data:'2026-03-08', hora:'19:00', preco:300.00},
      {id:1003, orig:'CGH', dest:'CWB', cia:'GOL', data:'2026-03-13', hora:'07:10', preco:270.63},
      {id:1004, orig:'CWB', dest:'CGH', cia:'GOL', data:'2026-03-15', hora:'20:50', preco:270.63},
      {id:1005, orig:'CWB', dest:'CGH', cia:'LATAM', data:'2026-03-20', hora:'20:25', preco:205.50},
      {id:1006, orig:'CGH', dest:'CWB', cia:'LATAM', data:'2026-03-22', hora:'21:35', preco:205.50},
      {id:1007, orig:'CWB', dest:'CGH', cia:'GOL', data:'2026-04-13', hora:'20:15', preco:183.74},
      {id:1008, orig:'CGH', dest:'CWB', cia:'LATAM', data:'2026-04-16', hora:'20:10', preco:207.88},
      {id:1009, orig:'CWB', dest:'CGH', cia:'LATAM', data:'2026-04-20', hora:'20:20', preco:207.88},
      {id:1010, orig:'CGH', dest:'CWB', cia:'GOL', data:'2026-04-23', hora:'20:15', preco:166.22},
      {id:1011, orig:'CWB', dest:'CGH', cia:'GOL', data:'2026-04-26', hora:'18:15', preco:166.22},
    ];

    const _stored = localStorage.getItem('cgh_cwb_flights');
    if(!_stored){ localStorage.setItem('cgh_cwb_flights', JSON.stringify(_defaultFlights)); }
    let flights = JSON.parse(localStorage.getItem('cgh_cwb_flights'));
    let filter = 'all';

    // ‚îÄ‚îÄ Real Price Data ‚îÄ‚îÄ
    let priceData = null;

    async function loadPrices() {
      try {
        const res = await fetch('data/prices.json');
        if (res.ok) {
          priceData = await res.json();
          console.log('Price data loaded:', priceData.generatedAt, priceData.weeks.length, 'weeks');
        }
      } catch (e) {
        console.warn('No price data available, using history-based ranking.', e);
      }
      updateFreshness();
    }

    function updateFreshness() {
      const bar = document.getElementById('freshness-bar');
      const dot = document.getElementById('freshness-dot');
      const txt = document.getElementById('freshness-text');
      if (priceData && priceData.generatedAt) {
        bar.style.display = 'flex';
        const age = (Date.now() - new Date(priceData.generatedAt).getTime()) / 3600000;
        if (age < 26) {
          dot.style.background = 'var(--green)';
          txt.textContent = 'Precos atualizados hoje ¬∑ ' + priceData.weeks.length + ' semanas cobertas ¬∑ Amadeus API';
        } else if (age < 72) {
          dot.style.background = 'var(--orange)';
          txt.textContent = 'Precos de ' + new Date(priceData.generatedAt).toLocaleDateString('pt-BR') + ' ¬∑ ' + priceData.weeks.length + ' semanas ¬∑ atualiza em breve';
        } else {
          dot.style.background = 'var(--red)';
          txt.textContent = 'Precos desatualizados (' + new Date(priceData.generatedAt).toLocaleDateString('pt-BR') + ') ¬∑ ranking usando historico';
        }
      } else {
        bar.style.display = 'flex';
        dot.style.background = 'var(--muted)';
        txt.textContent = 'Sem dados de preco da API ¬∑ ranking baseado no seu historico de compras';
      }
    }

    // ‚îÄ‚îÄ Weeks navigation ‚îÄ‚îÄ
    let weekOffset = 0;

    function getThursday(offset){
      const today = new Date();
      const day = today.getDay();
      const diff = (4 - day + 7) % 7 || 7;
      const thu = new Date(today);
      thu.setDate(today.getDate() + diff + offset * 7);
      return thu;
function nextWeek(){ if(weekOffset < 11) weekOffset++; renderWeek();  function nextWeek(){ if(weekOffset < 11) weekOffset++; renderWeek(); renderBuySignal();    function getSunday(thu){
      const sun = new Date(thu);
      sun.setDate(thu.getDate() + 3);
      return sun;
    }
    function fmtDateBR(d){ return d.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'}); }
    function fmtDateISO(d){
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return y + '-' + m + '-' + day;
    }
    function fmtDatePretty(d){ return d.toLocaleDateString('pt-BR',{weekday:'long',day:'2-digit',month:'long'}); }

    function buildGoogleFlightsURL(orig, dest, dateIda, dateVolta, airline, minHourIda, minHourVolta) {
      function encodeVarint(n) {
        const bytes = []; weekOffset = Math.max(0,weekOffset-1); renderWeek();  function prevWeek(){ weekOffset = Math.max(0,weekOffset-1); renderWeek(); renderBuySignal();h
        while (n > 0x7f) { bytes.push((n & 0x7f) | 0x80); n >>>= 7; }
        bytes.push(n & 0x7f);
        return bytes;
      function prevWeek(){ weekOffset = Math.max(0,weekOffset-1); renderWeek(); renderBuySignal(); }
                                                                                                                           function nextWeek(){ if(weekOffset < 11) weekOffset++; renderWeek(); renderBuySignal(); }
      function toBytes(s) { return Array.from(s).map(c => c.charCodeAt(0)); }
      function fieldBytes(fn, wt, ...v) { return [...encodeVarint((fn << 3) | wt), ...v]; }
      function ld(fn, inner) { return [...encodeVarint((fn << 3) | 2), ...encodeVarint(inner.length), ...inner]; }
      function airportField(code) { return [...fieldBytes(1, 0, ...encodeVarint(1)), ...ld(2, toBytes(code))]; }
      function buildLeg(date, o, d, minDep) {
        let inner = [...ld(2, toBytes(date)), ...ld(13, airportField(o)), ...ld(14, airportField(d))];
        if (minDep !== undefined) {
          inner = [...inner, ...fieldBytes(4, 0, ...encodeVarint(minDep * 60)), ...fieldBytes(5, 0, ...encodeVarint(23 * 60 + 59))];
        }
        return ld(3, inner);
      }
      let bytes = [
        ...fieldBytes(1, 0, ...encodeVarint(28)),
        ...fieldBytes(2, 0, ...encodeVarint(dateVolta ? 2 : 1)),
        ...buildLeg(dateIda, orig, dest, minHourIda),
      ];
      if (dateVolta) bytes = [...bytes, ...buildLeg(dateVolta, dest, orig, minHourVolta)];
      bytes = [...bytes, ...fieldBytes(8, 0, ...encodeVarint(1)), ...fieldBytes(9, 0, ...encodeVarint(1)), ...fieldBytes(14, 0, ...encodeVarint(1)),
        ...ld(16, [0x08,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x01]), ...fieldBytes(19, 0, ...encodeVarint(1))];
      const tfs = btoa(String.fromCharCode(...bytes)).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
      const airlineParam = airline ? '&airlines=' + airline : '';
      return 'https://www.google.com/travel/flights/search?tfs=' + tfs + '&hl=pt-BR&gl=BR&curr=BRL&sort=1' + airlineParam;
    }

    function buildKayakURL(orig, dest, dateIda, dateVolta, airline, minHourIda) {
      let url = dateVolta
        ? 'https://www.kayak.com.br/flights/' + orig + '-' + dest + '/' + dateIda + '/' + dateVolta + '?sort=price_a'
        : 'https://www.kayak.com.br/flights/' + orig + '-' + dest + '/' + dateIda + '?sort=price_a';
      if (airline) url += '&airlines=' + airline;
      if (minHourIda) url += '&deptime=' + String(minHourIda).padStart(2,'0') + '00-2359';
      return url;
    }

    function buildGOLURL(orig,dest,date){
      return 'https://www.voegol.com.br/pt/passagens-aereas?origem=' + orig + '&destino=' + dest + '&dataIda=' + date + '&adultos=1&criancas=0&bebes=0&tipoBusca=trecho';
    }
    function buildLatamURL(orig,dest,date){
      return 'https://www.latamairlines.com/br/pt/oferta-voos?origin=' + orig + '&outbound=' + date + 'T00%3A00%3A00.000Z&destination=' + dest + '&adt=1&chd=0&inf=0&trip=OW&cabin=Economy&redemption=false';
    }

    function renderWeek(){
      const thu = getThursday(weekOffset);
      const sun = getSunday(thu);
      const thuISO = fmtDateISO(thu);
      const sunISO = fmtDateISO(sun);

      document.getElementById('week-label').textContent =
        thu.toLocaleDateString('pt-BR',{day:'2-digit',month:'short'}) + ' ‚Äì ' +
        sun.toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'});
      document.getElementById('d-quinta').textContent = fmtDateBR(thu);
      document.getElementById('d-domingo').textContent = fmtDateBR(sun);

      // ‚îÄ‚îÄ Price-based ranking (real data ‚Üí history fallback) ‚îÄ‚îÄ
      const PRICE_LIMIT = 500;

      const avgByAirline = (cia) => {
        const list = flights.filter(f => f.cia === cia);
        return list.length ? list.reduce((s,f) => s + f.preco, 0) / list.length : null;
      };

      // Check for real price data for this week
      const weekData = priceData && priceData.weeks
        ? priceData.weeks.find(w => w.thursday === thuISO)
        : null;

      // Stale check: if price data is older than 3 days, treat as unreliable
      const priceAge = priceData ? (Date.now() - new Date(priceData.generatedAt).getTime()) / 3600000 : Infinity;
      const pricesReliable = priceAge < 72; // less than 3 days old

      const airlines = [
        { id:'GOL', code:'G3', color:'var(--gol)', label:'GOL', googleCode:'G3', kayakCode:'G3' },
        { id:'LATAM', code:'LA', color:'var(--latam)', label:'LATAM', googleCode:'LA', kayakCode:'LA' },
        { id:'Azul', code:'AD', color:'var(--azul)', label:'Azul', googleCode:'AD', kayakCode:'AD' },
      ];

      // Enrich each airline with price data
      airlines.forEach(a => {
        const realCombo = weekData && pricesReliable
          ? weekData.combos.find(c => c.airline === a.id)
          : null;

        if (realCombo) {
          a.totalPrice = realCombo.totalPrice;
          a.idaPrice = realCombo.idaPrice;
          a.voltaPrice = realCombo.voltaPrice;
          a.idaDep = realCombo.idaDeparture || null;
          a.voltaDep = realCombo.voltaDeparture || null;
          a.source = 'live';
        } else {
          const avg = avgByAirline(a.id);
          if (avg !== null) {
            a.totalPrice = Math.round(avg * 2 * 100) / 100;
            a.source = 'history';
          } else {
            a.totalPrice = PRICE_LIMIT;
            a.source = 'none';
          }
          a.idaPrice = null;
          a.voltaPrice = null;
          a.idaDep = null;
          a.voltaDep = null;
        }

        // Sort score: real price + GOL Smiles loyalty bonus (-R$15)
        a.sortScore = a.totalPrice - (a.id === 'GOL' ? 15 : 0);
      });

      // Check for mixed-carrier combo from real data
      let mixedCombo = null;
      if (weekData && pricesReliable) {
        const mix = weekData.combos.find(c => c.airlineCode === 'MIX');
        if (mix) {
          mixedCombo = {
            id: 'MIX', code: 'MIX', color: 'var(--purple)',
            label: mix.airline, googleCode: '', kayakCode: '',
            totalPrice: mix.totalPrice, idaPrice: mix.idaPrice, voltaPrice: mix.voltaPrice,
            idaDep: mix.idaDeparture, voltaDep: mix.voltaDeparture,
            source: 'live', mixed: true,
            sortScore: mix.totalPrice
          };
        }
      }

      // Sort airlines by price
      airlines.sort((a,b) => a.sortScore - b.sortScore);

      // If mixed combo is cheaper than #1, insert it at top
      const allOptions = [...airlines];
      if (mixedCombo && mixedCombo.sortScore < allOptions[0].sortScore) {
        allOptions.unshift(mixedCombo);
      }

      const best = allOptions[0];
      const c = document.getElementById('links-container');

      const headerLabel = '<div style="font-size:11px;color:var(--muted2);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;">IDA+VOLTA ¬∑ ' +
        thu.toLocaleDateString('pt-BR',{weekday:'long',day:'2-digit',month:'long'}) + ' (ida) ¬∑ ' +
        sun.toLocaleDateString('pt-BR',{weekday:'long',day:'2-digit',month:'long'}) + ' (volta)</div>';

      const cardHTML = (a, rank) => {
        const isBest = rank === 1;
        const gFlights = a.mixed ? buildGoogleFlightsURL('CGH','CWB',thuISO,sunISO,'',19,18) : buildGoogleFlightsURL('CGH','CWB',thuISO,sunISO,a.googleCode,19,18);
        const kayak = a.mixed ? buildKayakURL('CGH','CWB',thuISO,sunISO,'',19) : buildKayakURL('CGH','CWB',thuISO,sunISO,a.kayakCode,19);

        // Price display
        let priceHTML = '';
        if (a.source === 'live') {
          const budgetClass = a.totalPrice <= PRICE_LIMIT ? 'under' : 'over';
          const budgetLabel = a.totalPrice <= PRICE_LIMIT ? '‚úì DENTRO DO LIMITE' : '‚ö† ACIMA DO LIMITE';
          priceHTML = '<div class="price-tag real">R$ ' + a.totalPrice.toFixed(2) + '</div>' +
            '<div class="price-breakdown">ida <span>R$ ' + a.idaPrice.toFixed(2) + '</span> + volta <span>R$ ' + a.voltaPrice.toFixed(2) + '</span>' +
            ' <span class="source-tag live">API</span></div>' +
            '<span class="budget-tag ' + budgetClass + '">' + budgetLabel + '</span>';
        } else if (a.source === 'history') {
          priceHTML = '<div class="price-tag estimated">~R$ ' + a.totalPrice.toFixed(2) + ' estimado</div>' +
            '<div class="price-breakdown">baseado na media do seu historico <span class="source-tag hist">HIST</span></div>';
        } else {
          priceHTML = '<div class="price-tag estimated">Sem dados</div>' +
            '<div class="price-breakdown">abra o link para verificar o preco</div>';
        }

        const timeInfo = 'Ida apos 19h ¬∑ Volta apos 18h ¬∑ ' + a.label + ' ¬∑ menor preco';

        let banner = '';
        if (isBest) {
          banner = '<span class="best-pick-banner">‚≠ê #1 MELHOR PRECO</span>';
        } else if (a.mixed) {
          banner = '<span class="mix-tag">üîÄ MIX CIA</span>';
        } else if (a.id === 'GOL') {
          banner = '<span class="tag-pref">‚òÖ PREFERIDO</span>';
        } else {
          banner = '<span class="tag-alt">ALTERNATIVA</span>';
        }

        const rankClass = rank <= 3 ? 'r' + rank : 'r3';
        const registerCia = a.mixed ? 'GOL' : a.id;

        const registerBtn = isBest
          ? '<button class="best-pick-cta" onclick="openModal(\'CGH\',\'CWB\',\'' + registerCia + '\',\'' + thuISO + '\')">‚úì Registrar</button>'
          : '<button class="btn-reg" onclick="openModal(\'CGH\',\'CWB\',\'' + registerCia + '\',\'' + thuISO + '\')">+ Registrar</button>';

        const cardClass = isBest ? 'best-pick' : (a.mixed ? 'mixed' : (a.id === 'GOL' ? 'priority' : ''));

        return '<div class="sl-card ' + cardClass + '">' +
          '<div class="rank-badge ' + rankClass + '">' + rank + '</div>' +
          '<div class="sl-airline" style="color:' + a.color + '">' + a.label + '</div>' +
          '<div class="sl-info">' +
            '<div class="sl-route">CGH ‚Üí CWB ‚Üí CGH ¬∑ Round Trip</div>' +
            '<div class="sl-detail">' + timeInfo + '</div>' +
            priceHTML +
          '</div>' +
          '<div class="sl-actions">' +
            banner +
            '<a class="btn-search" style="background:#34a853" href="' + gFlights + '" target="_blank">üåê Google Flights</a>' +
            '<a class="btn-search" style="background:#ff690f" href="' + kayak + '" target="_blank">üîç Kayak</a>' +
            registerBtn +
          '</div>' +
        '</div>';
      };

      const hasRealData = allOptions.some(a => a.source === 'live');
      const rankingExplain = hasRealData
        ? 'üí° <strong style="color:var(--text)">Ranking por preco real:</strong> precos atualizados via Amadeus API ‚Üí menor preco ida+volta ‚Üí GOL recebe bonus de -R$15 (Smiles). Se total ‚â§ <strong style="color:var(--green)">R$ 500</strong>, clique em <strong style="color:var(--green)">Registrar</strong>.'
        : 'üí° <strong style="color:var(--text)">Ranking por historico:</strong> sem dados da API ainda. Ordenado pela media do seu historico de compras ‚Üí GOL recebe bonus de -R$20 (Smiles). Configure o GitHub Action para precos reais.';

      c.innerHTML = headerLabel +
        allOptions.map((a,i) => cardHTML(a, i + 1)).join('') +
        '<div style="margin-top:12px;padding:12px 14px;background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.2);border-radius:4px;font-size:11px;color:var(--muted2);line-height:1.7;">' +
        rankingExplain + '</div>';
    }

    707
    { weekOffset = Math.max(0,weekOffset-1); renderWeek(); }
    function nextWeek(){ if(weekOffset < 11) weekOffset++; renderWeek(); }

    // ‚îÄ‚îÄ Modal ‚îÄ‚îÄ
    function openModal(orig,dest,cia,date){
      document.getElementById('m-origem').value = orig;
      document.getElementById('m-destino').value = dest;
      document.getElementById('m-cia').value = cia;
      document.getElementById('m-data').value = date;
      document.getElementById('m-hora').value = '';
      document.getElementById('m-preco').value = '';
      document.getElementById('m-context').textContent = 'Registrando: ' + orig + ' ‚Üí ' + dest + ' ¬∑ ' + new Date(date+'T12:00:00').toLocaleDateString('pt-BR') + ' ¬∑ ' + cia;
      document.getElementById('overlay').classList.add('open');
    }
    function closeModal(){ document.getElementById('overlay').classList.remove('open'); }

    function confirmRegister(){
      const orig = document.getElementById('m-origem').value.toUpperCase();
      const dest = document.getElementById('m-destino').value.toUpperCase();
      const cia = document.getElementById('m-cia').value;
      const data = document.getElementById('m-data').value;
      const hora = document.getElementById('m-hora').value;
      const preco = parseFloat(document.getElementById('m-preco').value);
      if(!preco || preco <= 0){ alert('Insira o preco pago.'); return; }
const editId = document.getElementById('overlay').dataset.editId; if(editId){ const f = flights.find(x => x.id === parseInt(editId)); if(f){ f.orig = orig; f.dest = dest; f.cia = cia; f.data = data; f.hora = hora; f.preco = preco; document.getElementById('overlay').dataset.editId = ''; } } else { flights.unshift({id:Date.now(),orig,dest,cia,data,hora,preco}); } save(); render(); closeModal(); showToast(editId ? '‚úì Passagem atualizada!' : '‚úì Passagem registrada no tracker!');    }

    // ‚îÄ‚îÄ Manual ‚îÄ‚îÄ
    function addManual(){
      const orig = document.getElementById('f-origem').value.toUpperCase();
      const dest = document.getElementById('f-destino').value.toUpperCase();
      const cia = document.getElementById('f-cia').value;
      const data = document.getElementById('f-data').value;
      const hora = document.getElementById('f-hora').value;
      const preco = parseFloat(document.getElementById('f-preco').value);
      if(!orig||!dest||!cia||!data||!preco){ alert('Preencha todos os campos.'); return; }
      flights.unshift({id:Date.now(),orig,dest,cia,data,hora,preco});
      save(); render();
      document.getElementById('f-data').value='';
      document.getElementById('f-hora').value='';
      document.getElementById('f-preco').value='';
      showToast('‚úì Passagem registrada!');
    }

    // ‚îÄ‚îÄ Save / render ‚îÄ‚îÄ
    function save(){ localStorage.setItem('cgh_cwb_flights',JSON.stringify(flights)); }
    function fmtBRL(v){ return 'R$ '+v.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
    function fmtDt(d){ if(!d) return '‚Äî'; const [y,m,day]=d.split('-'); return day+'/'+m+'/'+y; }

    function render(){
      const total = flights.reduce((a,f)=>a+f.preco,0);
      const media = flights.length ? total/flights.length : 0;
      const gols = flights.filter(f=>f.cia==='GOL').length;
      document.getElementById('s-total').textContent = fmtBRL(total);
      document.getElementById('s-count').textContent = flights.length;
      document.getElementById('s-media').textContent = flights.length ? fmtBRL(media) : 'R$ 0';
      document.getElementById('s-gol').textContent = gols;
      renderTable(); renderAnalytics();
    }

    function filterBy(val,btn){
      filter=val;
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      renderTable();
    }

    function renderTable(){
      const list = filter==='all' ? flights : flights.filter(f=>f.cia===filter);
      const wrap = document.getElementById('table-wrap');
      if(!list.length){
        wrap.innerHTML='<div class="empty-state"><div class="icon">‚úàÔ∏è</div><p>'+(flights.length?'Nenhum voo neste filtro.':'Nenhuma passagem ainda.<br>Use a aba Buscar Voo para come√ßar!')+'</p></div>';
        return;
      }
      wrap.innerHTML='<table><thead><tr><th>Rota</th><th>Companhia</th><th>Data</th><th>Hor√°rio</th><th>Pre√ßo</th><th></th></tr></thead><tbody>'+
        list.map(f=>'<tr><td class="route-cell">'+f.orig+'<span class="arrow">‚Üí</span>'+f.dest+'</td>'+
        '<td><span class="cia-badge"><span class="cia-dot" style="background:'+(COR[f.cia]||'#888')+'"></span>'+f.cia+'</span></td>'+
        '<td class="date-cell">'+fmtDt(f.data)+'</td><td class="time-cell">'+(f.hora||'‚Äî')+'</td>'+
        '<td class="price-cell">'+fmtBRL(f.preco)+'</td>'+
'<td><button class="edt-btn" onclick="editFlight('+f.id+')"  746
          '+f.id+')")>&Check;</button></td>'+'<td><button class="del-btn" onclick="del('+f.id+')">‚úï</button></td></tr>').join('')+        '</tbody></table>';
    }

    function editFlight(id){ const f = flights.find(x => x.id === id); if(!f) return; document.getElementById('m-origem').value = f.orig; document.getElementById('m-destino').value = f.dest; document.getElementById('m-cia').value = f.cia; document.getElementById('m-data').value = f.data; document.getElementById('m-hora').value = f.hora || ''; document.getElementById('m-preco').value = f.preco; document.getElementById('m-context').textContent = 'Editando: ' + f.orig + ' ‚Üí ' + f.dest + ' ¬∑ ' + fmtDt(f.data) + ' ¬∑ ' + f.cia; document.getElementById('overlay').dataset.editId = id; document.getElementById('overlay').classList.add('open'); }

    function renderAnalytics(){
      const byM={};
      flights.forEach(f=>{ const k=f.data?f.data.slice(0,7):'N/A'; byM[k]=(byM[k]||0)+f.preco; });
      const months=Object.keys(byM).sort().slice(-6);
      const vals=months.map(m=>byM[m]);
      const maxV=Math.max(...vals)||1;
      const mn={'01':'Jan','02':'Fev','03':'Mar','04':'Abr','05':'Mai','06':'Jun','07':'Jul','08':'Ago','09':'Set','10':'Out','11':'Nov','12':'Dez'};
      const bars=document.getElementById('bars-container');
      bars.innerHTML = months.length ? months.map((m,i)=>{
        const pct=Math.max(6,(vals[i]/maxV)*100);
        const lbl=m==='N/A'?'N/A':(mn[m.slice(5)]||m.slice(5))+' '+m.slice(2,4);
        return '<div class="bar-wrap"><div class="bar-val">'+fmtBRL(vals[i]).replace('R$ ','')+'</div><div class="bar-col" style="height:'+pct+'%"></div><div class="bar-label">'+lbl+'</div></div>';
      }).join('') : '<span style="color:var(--muted);font-size:12px;margin:auto">Nenhum dado ainda.</span>';
      const byCia={};
      flights.forEach(f=>{ byCia[f.cia]=(byCia[f.cia]||0)+f.preco; });
      const split=document.getElementById('cia-split');
      split.innerHTML = Object.keys(byCia).length ?
        Object.entries(byCia).map(([c,v])=>'<div class="cia-item"><div class="cia-name" style="color:'+(COR[c]||'#888')+'">'+c+'</div><div class="cia-sub">'+fmtBRL(v)+' ¬∑ '+flights.filter(f=>f.cia===c).length+' voo(s)</div></div>').join('') :
        '<span style="color:var(--muted);font-size:12px">Sem registros.</span>';
    }

    function showTab(name){
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.getElementById('tab-'+name).classList.add('active');
      event.target.classList.add('active');
    }
    function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2800); }

    // ‚îÄ‚îÄ Buy Signal ‚îÄ‚îÄ
    function renderBuySignal() {
const now = new Date();
          const dow = now.getDay();
          const hour = now.getHours();
          const thu = getThursday(weekOffset);
          const daysUntilFlight = Math.ceil((thu - now) / (1000*60*60*24));
              let score = 50;
      const dayScore = {0:-20, 1:5, 2:20, 3:20, 4:-5, 5:-15, 6:-20};
      score += dayScore[dow] || 0;
      if (hour >= 0 && hour < 6) score += 10;
      else if (hour >= 6 && hour < 10) score += 8;
      else if (hour >= 21) score += 5;
      else if (hour >= 17 && hour < 21) score -= 8;
      if (daysUntilFlight >= 45) score += 15;
      else if (daysUntilFlight >= 30) score += 10;
      else if (daysUntilFlight >= 14) score += 0;
      else if (daysUntilFlight >= 7) score -= 10;
      else score -= 25;

      const dayNames = ['domingo','segunda-feira','ter√ßa-feira','quarta-feira','quinta-feira','sexta-feira','s√°bado'];
      const dayNamesShort = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
      function nextGoodDay() {
        for (let i = 1; i <= 7; i++) {
          const d = (dow + i) % 7;
          if (d === 2) return dayNames[2] + ' (em ' + i + 'd)';
          if (d === 3) return dayNames[3] + ' (em ' + i + 'd)';
        }
      }

      const el = document.getElementById('buy-signal');
      let signal, icon, title, sub, tooltip;

      if (score >= 60) {
        signal = 'good'; icon = '‚úÖ'; title = 'Bom dia para comprar';
        sub = daysUntilFlight >= 30
          ? dayNamesShort[dow] + ' ¬∑ ' + daysUntilFlight + 'd at√© o voo'
          : dayNamesShort[dow] + ' ¬∑ Compre logo';
        tooltip = '<strong style="color:var(--green)">‚úÖ Condi√ß√µes favor√°veis hoje</strong><br><br>' +
          'üìÖ <b>Dia de compra:</b> ' + dayNames[dow] + ' costuma ter tarifas revisadas pelas cias.<br>' +
          '‚è∞ <b>Hora:</b> ' + hour + 'h ‚Äî ' + (hour < 10 ? 'manh√£ cedo, bom para ofertas' : hour >= 21 ? 'noite, cias revisam tarifas' : 'hor√°rio OK') + '<br>' +
          '‚úàÔ∏è <b>Anteced√™ncia:</b> ' + daysUntilFlight + ' dias ‚Äî ' + (daysUntilFlight >= 30 ? 'janela ideal (30-60d)' : 'compre logo') + '<br><br>' +
          '<em>Fonte: Google Flights, Skyscanner & Kayak data</em>';
      } else if (score >= 35) {
        signal = 'wait'; icon = '‚è≥'; title = 'Momento neutro';
        sub = 'Aguarde ' + nextGoodDay();
        tooltip = '<strong style="color:var(--orange)">‚è≥ Pode melhorar em breve</strong><br><br>' +
          'üìÖ <b>Hoje:</b> ' + dayNames[dow] + ' ‚Äî demanda moderada de pesquisa.<br>' +
          '‚úàÔ∏è <b>Anteced√™ncia:</b> ' + daysUntilFlight + ' dias at√© o voo.<br>' +
          'üí° <b>Dica:</b> Ter√ßa e quarta-feira tendem a ter melhores pre√ßos.<br><br>' +
          '<em>Fonte: Google Flights, Skyscanner & Kayak data</em>';
      } else {
        signal = 'bad'; icon = '‚ö†Ô∏è';
        if (daysUntilFlight < 7) {
          title = '√öltima hora ‚Äî caro'; sub = 'Voo em ' + daysUntilFlight + 'd ¬∑ Pre√ßos altos';
        } else {
          title = 'Evite comprar hoje'; sub = 'Espere ' + nextGoodDay();
        }
        tooltip = '<strong style="color:var(--red)">‚ö†Ô∏è Condi√ß√µes desfavor√°veis</strong><br><br>' +
          'üìÖ <b>Hoje:</b> ' + dayNames[dow] + ' ‚Äî alta demanda eleva pre√ßos.<br>' +
          '‚úàÔ∏è <b>Anteced√™ncia:</b> ' + daysUntilFlight + ' dias. ' + (daysUntilFlight < 14 ? 'Pouco tempo: se precisar, compre assim mesmo.' : 'Aguarde alguns dias.') + '<br>' +
          'üí° <b>Melhor momento:</b> ter√ßa ou quarta-feira, 30-60 dias antes.<br><br>' +
          '<em>Fonte: Google Flights, Skyscanner & Kayak data</em>';
      }

      el.className = 'buy-signal ' + signal;
      document.getElementById('bs-icon').textContent = icon;
      document.getElementById('bs-title').textContent = title;
      document.getElementById('bs-sub').textContent = sub;
      document.getElementById('bs-tooltip').innerHTML = tooltip;
    }

    // ‚îÄ‚îÄ Init (async to load prices first) ‚îÄ‚îÄ
    (async () => {
      await loadPrices();
      renderWeek();
      render();
      renderBuySignal();
    })();
  </script>
</body>
</html>
h
